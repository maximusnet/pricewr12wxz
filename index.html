<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Kaspi Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body style="margin: 0; padding: 0; background: #fff; font-family: sans-serif;">

<h2 style="text-align:center; margin-top:40px;">Тест кнопки Kaspi</h2>

<!-- Видимая кнопка Kaspi -->
<div class="ks-widget"
     data-template="button"
     data-merchant-sku="103521901"
     data-merchant-code="1080012"
     data-city="750000000"
     data-style="mobile"
     style="display: flex; justify-content: center; margin-top: 40px;"
     id="ks-widget-container">
</div>

<!-- Подключаем официальный скрипт -->
<script>
  (function(d, s, id) {
    if (d.getElementById(id)) return;
    const js = d.createElement(s);
    js.id = id;
    js.src = 'https://kaspi.kz/kaspibutton/widget/ks-wi_ext.js';
    const ref = d.getElementsByTagName(s)[0];
    ref.parentNode.insertBefore(js, ref);
  })(document, 'script', 'KS-Widget');
</script>

<!-- Автоклик через 1.5 секунды. Без fallback. -->
<script>
  window.addEventListener('load', () => {
    setTimeout(() => {
      // Пытаемся получить ссылку из iframe и перенаправить
      const iframe = document.querySelector('#ks-widget-container iframe');
      if (iframe) {
        // Вытаскиваем href из src-параметра 'url' виджета
        const params = new URLSearchParams(iframe.src.split('?')[1]);
        const encodedUrl = params.get('url');
        if (encodedUrl) {
          window.location.href = decodeURIComponent(encodedUrl);
        }
      }
    }, 1500);
  });
</script>

</body>
</html>
